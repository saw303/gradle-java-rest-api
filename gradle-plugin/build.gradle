apply from: "${rootDir}/gradle/groovy.gradle"

ext {
    pomDescription = 'Gradle plugin to generate REST APIs for JAX-RS or Spring-Boot projects'
}

dependencies {

    implementation project(':json-model')

    compileOnly gradleApi()
    testImplementation gradleTestKit()

    testCompile("org.spockframework:spock-core:${spockVersion}") {
        exclude group: 'org.codehaus.groovy', module: 'groovy-all'
    }

    implementation "com.squareup:javapoet:${javaPoetVersion}"
    implementation "com.google.guava:guava:${guavaVersion}"
    implementation "com.google.code.gson:gson:${gsonVersion}"
}

task checkVersion(type: Test) {
    File file = file("${projectDir}/src/main/groovy/ch/silviowangler/gradle/restapi/RestApiPlugin.groovy")
    String content = file.text

    String msg = "Wrong version in ${file.absolutePath}"

    if (! content.contains("final String pluginVersion = \"1.3.0\"")) {
        throw new RuntimeException(msg)
    }

    if (! content.contains("implementation \"ch.silviowangler.rest:rest-api-spring:\${pluginVersion}\"")) {
        throw new RuntimeException(msg)
    }

    if (! content.contains("implementation \"ch.silviowangler.rest:rest-api-micronaut:\${pluginVersion}\"")) {
        throw new RuntimeException(msg)
    }
}